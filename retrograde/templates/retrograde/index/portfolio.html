{% load tz %}
<div id="portfolio-card" class="card">
    <div class="card-body" style="display: flex; padding: 30px 30px 0px 30px;">
        <div style="flex: 3;">
            <!-- Content for the first div -->
            <h3 class="card-title">{{ portfolio.name }}</h3>
            <h6 class="card-subtitle mb-2 text-body-secondary">{{ portfolio.now_datetime|timezone:user_timezone }}</h6>
{% comment %}             <a href="#" class="card-link">Card link</a>
            <a href="#" class="card-link">Another link</a> {% endcomment %}
        </div>
        <div style="flex: 1; text-align: right;">
            <h3 style="margin-bottom: 0px;">{{ portfolio.value }}</h3>

            {% if portfolio.change_status == "POSITIVE" %}
                <h6><span class="badge text-bg-success">{{ portfolio.change }}</span></h6>    
            {% elif portfolio.change_status == "ZERO" %}
                <h6><span class="badge text-bg-warning">--</span></h6>    
            {% elif portfolio.change_status == "NEGATIVE" %}
                <h6><span class="badge text-bg-danger">{{ portfolio.change }}</span></h6>    
            {% endif %}
        

        </div>
    </div>
    <!-- Place the canvas element below the flex container -->
    <canvas id="{{ portfolio.name|add:'_myLineChart' }}" class="small_line_chart" style="width: 100%; height: 70px; margin: 10px 30px 30px 30px;"></canvas>
</div>
<script>
    document.addEventListener('DOMContentLoaded', function () {
        // Sample data
        var price_data = {{ portfolio.price_data|safe }};
        console.log("price_data", price_data);

        // Convert labels to Date objects
        var dateLabels = price_data["datetime"].map(function (label) {
            return luxon.DateTime.fromFormat(label, 'yyyy-MM-dd').toJSDate();
        });

        // Get the canvas element
        var ctx = document.getElementById("{{portfolio.name}}" + '_myLineChart').getContext('2d');
        ctx.canvas.width = '972px';
        ctx.canvas.height = '166px';

        // Create a financial chart (line chart with financial features)
        var myFinancialChart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: price_data["datetime"],
                datasets: [{
                    label: 'Portfolio value',
                    data: price_data["value"],
                    borderColor: function (context) {
                        var change_status = "{{ portfolio.change_status|safe }}";
                        if (change_status == "NEGATIVE") {
                            return 'rgba(220, 53, 69, 1)';
                        } else {
                            return 'rgba(53, 199, 89, 1)';
                        }
                    },
                    borderWidth: 3,
                    pointRadius: 0,
                    type: 'line', // Set the type to 'line'
                }]
            },
            options: {

                scales: {
                    x: {
                        type: 'time',
                        time: {
                            unit: 'minute'
                        },
                        ticks: {
                            maxTicksLimit: 10, // Set the maximum number of x-axis labels
                            maxRotation: 0,   // Set the maximum label rotation angle
                            minRotation: 0,
                            font: {
                                size: 11,
                                weight: 'bold'
                            },  
                        }
                    },
                    y: {
                        beginAtZero: false,
                        position: 'right',
                        ticks: {
                            // You can add additional y-axis tick options here if needed
                            offset: -10,
                            font: {
                                size: 11,
                                weight: 'bold'
                            },  
                        }
                    }
                },
                plugins: {
                    legend: {
                        display: false
                    }
                }
            }
        });

    });
</script>
{% comment %} <script>
    document.addEventListener('DOMContentLoaded', function () {
        // Sample data
        var portfolio = {{ portfolio|safe }};
        console.log("portfolio", portfolio);

        // Convert labels to Date objects
        var dateLabels = portfolio.price_data[0].labels.map(function (label) {
            return luxon.DateTime.fromFormat(label, 'yyyy-MM-dd').toJSDate();
        });

        // Get the canvas element
        var ctx = document.getElementById(portfolio.name + '_myLineChart').getContext('2d');
        ctx.canvas.width = '100%';
        ctx.canvas.height = '70px';


        // Create a line chart
        var myLineChart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: portfolio.price_data[0].labels,
                datasets: [{
                    label: 'Portfolio value',
                    data: portfolio.price_data[1].data,
                    fill: false,
                    borderColor: function (context) {
                        var change_status = "{{ portfolio.change_status|safe }}";
                        // Your custom logic to determine the border color
                        if (change_status == "NEGATIVE") {
                            return 'rgba(220, 53, 69, 1)';
                        } else {
                            return 'rgba(53, 199, 89, 1)';
                        }
                    },
                    borderWidth: 3,
                    pointRadius: 0
                }]
            },
            options: {
                scales: {
                    
                    y: {
                        beginAtZero: false
                    }
                },
                plugins: {
                    legend: {
                        display: false
                    }
                }
            }
        });

    });
</script>


 {% endcomment %}