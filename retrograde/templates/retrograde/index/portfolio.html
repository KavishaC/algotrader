<div id="portfolio-card" class="card">
    <div class="card-body" style="display: flex; padding: 30px 30px 0px 30px;">
        <div style="flex: 3;">
            <!-- Content for the first div -->
            <h4 class="card-title">{{ portfolio.name }}</h4>
            <h6 class="card-subtitle mb-2 text-body-secondary"><small>Simulation Date: {{ portfolio.date|date:"l, j F Y" }}</small> </h6>
            {% comment %}             <a href="#" class="card-link">Card link</a>
            <a href="#" class="card-link">Another link</a> {% endcomment %}
        </div>
        <div style="flex: 1; text-align: right;">
            <h4 style="margin-bottom: 0px;">{{ portfolio.value }}</h4>
            
            {% if portfolio.change_status == "POSITIVE" %}
            <h6><span class="badge text-bg-success">{{ portfolio.change }}</span></h6>    
            {% elif portfolio.change_status == "ZERO" %}
            <h6><span class="badge text-bg-light">{{ portfolio.change }}</span></h6>    
            {% elif portfolio.change_status == "NEGATIVE" %}
            <h6><span class="badge text-bg-danger">{{ portfolio.change }}</span></h6>    
            {% endif %}
            
            
        </div>
    </div>
    <!-- Place the canvas element below the flex container -->
    <canvas id="{{ portfolio.id|stringformat:"i"|add:'_myLineChart' }}" class="small_line_chart" style="width: 100%; height: 125px; margin: 10px 30px 30px 30px;"></canvas>
</div>
<script>
    document.addEventListener('DOMContentLoaded', function () {
        // Sample data
        var price_data = {{ portfolio.price_data|safe }};
        console.log("price_data", price_data);
        
        //// Convert labels to Date objects
        //var dateLabels = price_data["datetime"].map(function (label) {
            //    return luxon.DateTime.fromFormat(label, 'yyyy-MM-dd').toJSDate();
            //});
            
            // Get the canvas element
            var ctx = document.getElementById("{{portfolio.id}}" + '_myLineChart').getContext('2d');
            ctx.canvas.height = 125;
            
            portfolioChangeStatus = "{{ portfolio.change_status }}";
            if (portfolioChangeStatus === "NEGATIVE") {
                borderColor = 'rgba(255, 75, 66, 1)';
                backgroundColor = 'rgba(255, 75, 66, 0.15)';
            } else {
                borderColor = 'rgba(100, 220, 150, 1)';
                backgroundColor = 'rgba(100, 220, 150, 0.15)';
            }
            
            // Create a financial chart (line chart with financial features)
            var myFinancialChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: price_data["date"],
                    datasets: [{
                        label: 'Portfolio value',
                        data: price_data["value"],
                        borderColor: function (context) {
                            var change_status = "{{ portfolio.change_status|safe }}";
                            if (change_status == "NEGATIVE") {
                                return 'rgba(220, 53, 69, 1)';
                            } else {
                                return 'rgba(53, 199, 89, 1)';
                            }
                        },
                        borderWidth: 3,
                        pointRadius: 0,
                        type: 'line', // Set the type to 'line'
                        fill: true,
                        backgroundColor: backgroundColor,
                        borderColor: borderColor,
                        pointRadius: 0,
                        pointHoverRadius: 0,
                    }]
                },
                options: {
                    
                    scales: {
                        x: {
                            type: 'time',
                            time: {
                                unit: 'day'
                            },
                            grid: {
                                display: false, // Turn off x-axis grid lines
                            },
                            ticks: {
                                maxTicksLimit: 4, // Set the maximum number of x-axis labels
                                maxRotation: 0,   // Set the maximum label rotation angle
                                minRotation: 0,
                                font: {
                                    size: 11,
                                    weight: 'bold'
                                },  
                            }
                        },
                        y: {
                            beginAtZero: false,
                            position: 'right',
                            grid: {
                                display: false, // Turn off x-axis grid lines
                            },
                            ticks: {
                                maxTicksLimit: 4, // Set the maximum number of x-axis labels
                                // You can add additional y-axis tick options here if needed
                                offset: -10,
                                crossAlign: 'far',
                                font: {
                                    size: 11,
                                    weight: 'bold'
                                },  
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            enabled: false,
                          },
                    }
                },
                
                
            });
            
        });
    </script>
    